<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
  
<mapper namespace="com.leaf.myapp.dao.ProductDAO">
	<!-- 발주페이지 제품리스트 -->
	<select id="ProductList"  resultType="com.leaf.myapp.vo.ProductVO">
		select hq_num, hq_name, ware_price, ware_cnt, ware_date, part_num, emp_num from product
	</select>
	<!-- 발주시 제품클릭하면 파트너, 발주창 ajax-->	
	<select id="ProductPartner" parameterType="int" resultType="com.leaf.myapp.vo.ProductVO">
  		select h.hq_num, h.hq_name, h.ware_price, h.part_num, p.part_company, p.part_name, p.part_tel, p.part_email, p.part_code_name from product h join partner p on h.part_num = p.part_num where hq_num=#{param1}
  	</select>
	<!-- 발주하기 -->	
	<insert id="Purchase_RegisterOk" parameterType="com.leaf.myapp.vo.ProductVO">	
		insert into purchase(pc_num, pc_cnt, hq_num , fc_num, order_status) values(purchase_sq.nextval, #{pc_cnt},#{hq_num}, 2 , 1)
	</insert>
	<!-- 가맹점이 보는 발주리스트 (가맹점페이지) -->	
	<select id="purchaseList" resultType="com.leaf.myapp.vo.ProductVO">
		select p.pc_num, h.hq_num, h.hq_name, h.ware_price,p.pc_cnt, p.pc_date, order_status from product h join purchase p on h.hq_num = p.hq_num
	</select>
	
	<!-- 본사가 보는 전체가맹점 발주리스트(본사페이지) -->	
	<select id="purchaseListAll" resultType="com.leaf.myapp.vo.ProductVO">
		select p.pc_num, f.fc_name, h.hq_num, h.hq_name, h.ware_price, p.pc_cnt, p.pc_date, p.order_status from product h join purchase p on p.hq_num = h.hq_num join franchise f on p.fc_num = f.fc_num
	</select>
	
 	<!-- 입고리스트 -->
 	<select id="WarehousingList" resultType="com.leaf.myapp.vo.ProductVO">
		 select h.hq_num, p.part_code_name, h.hq_name, h.ware_price, h.ware_cnt, p.part_name, p.part_company, p.part_tel, p.part_email, h.ware_date, pc.order_status, f.fc_name, pc.pc_date from product h full outer join partner p on h.part_num = p.part_num full outer join purchase pc on h.hq_num = pc.hq_num full outer join franchise f on f.fc_num = pc.fc_num
	</select>
	<!-- 입고등록 -->	
	<insert id="Warehousing_RegisterOk" parameterType="com.leaf.myapp.vo.ProductVO">	
		insert into product(hq_num, part_num, hq_name, ware_cnt, ware_price, emp_num) values(product_sq.nextval, #{part_num}, #{hq_name}, #{ware_cnt}, #{ware_price}, #{emp_num})
	</insert>
	<!-- 가맹점이 발주한거 리스트로 취소 -->
	<!-- 유저아이디 나중에 넣어야함.... -->
     <delete id="purchaseDel">
        delete from purchase where pc_num in 
        <foreach item="item" index="index" collection="list"
         open="(" separator="," close=")">
        #{item}
        </foreach>
     </delete>
     <update id="purchaseConfirm" parameterType="com.leaf.myapp.vo.ProductVO">
     	update purchase set order_status = 2 where pc_num = #{pc_num}   
     </update>
     
</mapper>